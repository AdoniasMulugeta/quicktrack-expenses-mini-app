<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>QuickTrack Expenses</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header class="app-header">
    <span class="app-title">QuickTrack</span>
    <button class="currency-toggle" id="currency-btn">ETB</button>
  </header>

  <!-- Offline banner -->
  <div class="offline-banner hidden" id="offline-banner">
    Offline â€” data saved locally, syncs later
  </div>

  <!-- Tabs -->
  <nav class="tab-bar">
    <button class="tab-btn active" data-view="list">Expenses</button>
    <button class="tab-btn" data-view="summary">Summary</button>
    <button class="tab-btn" data-view="groups">Groups</button>
  </nav>

  <!-- LIST VIEW -->
  <div class="view" id="list-view">
    <!-- Search -->
    <div class="search-bar">
      <input type="search" class="search-input" id="search-input" placeholder="Search expenses...">
    </div>

    <!-- Filter chips -->
    <div class="filter-chips">
      <button class="filter-chip" data-cat="food">ğŸ” Food</button>
      <button class="filter-chip" data-cat="transport">ğŸšŒ Transport</button>
      <button class="filter-chip" data-cat="bills">ğŸ“„ Bills</button>
      <button class="filter-chip" data-cat="other">ğŸ“¦ Other</button>
    </div>

    <!-- Expense list -->
    <div class="expense-list" id="expense-list"></div>

    <!-- Empty state -->
    <div class="empty-state" id="empty-state">
      <div class="empty-icon">ğŸ“Š</div>
      <p>No expenses yet</p>
      <p class="empty-hint">Tap "Add Expense" to start tracking</p>
    </div>
  </div>

  <!-- ADD/EDIT VIEW -->
  <div class="view hidden" id="add-view">
    <div class="form-view">
      <h2 class="form-title" id="form-title">Add Expense</h2>

      <div class="form-group">
        <label class="form-label">Amount</label>
        <div class="amount-input-wrap">
          <input type="number" class="form-input" id="input-amount"
                 placeholder="0.00" inputmode="decimal" step="0.01" min="0">
          <span class="currency-label" id="form-currency">ETB</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Category</label>
        <input type="hidden" id="input-category" value="food">
        <div class="category-grid">
          <div class="category-option selected" data-cat="food">
            <span class="cat-icon">ğŸ”</span>
            <span class="cat-name">Food</span>
          </div>
          <div class="category-option" data-cat="transport">
            <span class="cat-icon">ğŸšŒ</span>
            <span class="cat-name">Transport</span>
          </div>
          <div class="category-option" data-cat="bills">
            <span class="cat-icon">ğŸ“„</span>
            <span class="cat-name">Bills</span>
          </div>
          <div class="category-option" data-cat="other">
            <span class="cat-icon">ğŸ“¦</span>
            <span class="cat-name">Other</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Note (optional)</label>
        <input type="text" class="form-input" id="input-note"
               placeholder="e.g., Lunch at cafe" maxlength="100">
      </div>

      <button class="btn btn-primary" id="btn-save">Save</button>
      <button class="btn btn-danger hidden" id="btn-delete-form">Delete Expense</button>
    </div>
  </div>

  <!-- DETAIL VIEW -->
  <div class="view hidden" id="detail-view">
    <div class="detail-view">
      <div class="detail-icon" id="detail-icon">ğŸ”</div>
      <div class="detail-amount" id="detail-amount">0.00 ETB</div>
      <div class="detail-category" id="detail-category">Food</div>

      <div class="detail-meta">
        <div class="detail-row">
          <span class="detail-row-label">Note</span>
          <span class="detail-row-value" id="detail-note">â€”</span>
        </div>
        <div class="detail-row">
          <span class="detail-row-label">Date</span>
          <span class="detail-row-value" id="detail-date">â€”</span>
        </div>
      </div>

      <div class="detail-actions">
        <button class="btn btn-secondary" id="btn-edit">Edit</button>
        <button class="btn btn-danger" id="btn-delete" style="background:var(--destructive);color:#fff">Delete</button>
      </div>
    </div>
  </div>

  <!-- SUMMARY VIEW -->
  <div class="view hidden" id="summary-view">
    <div class="summary-view">
      <h2 class="summary-header">Monthly Summary</h2>

      <div class="summary-cards">
        <div class="summary-card">
          <div class="sc-label">Total</div>
          <div class="sc-value" id="summary-total">0.00</div>
        </div>
        <div class="summary-card">
          <div class="sc-label">Daily Avg</div>
          <div class="sc-value" id="summary-avg">0.00</div>
        </div>
        <div class="summary-card">
          <div class="sc-label">Count</div>
          <div class="sc-value" id="summary-count">0</div>
        </div>
      </div>

      <div class="chart-wrap">
        <canvas id="pie-chart" width="200" height="200"></canvas>
      </div>

      <div id="category-breakdown"></div>
    </div>
  </div>

  <!-- GROUPS LIST VIEW -->
  <div class="view hidden" id="groups-view">
    <div class="groups-view">
      <div class="groups-header">
        <h2 class="form-title">Groups</h2>
        <button class="btn-icon" id="btn-create-group" title="Create group">+</button>
      </div>
      <div id="group-list" class="group-list"></div>
      <div class="empty-state hidden" id="groups-empty">
        <div class="empty-icon">ğŸ‘¥</div>
        <p>No groups yet</p>
        <p class="empty-hint">Create a group to share expenses with friends</p>
      </div>
    </div>
  </div>

  <!-- CREATE GROUP VIEW -->
  <div class="view hidden" id="create-group-view">
    <div class="form-view">
      <h2 class="form-title">Create Group</h2>
      <div class="form-group">
        <label class="form-label">Group Name</label>
        <input type="text" class="form-input" id="input-group-name"
               placeholder="e.g., Apartment, Trip to Paris" maxlength="50">
      </div>
      <button class="btn btn-primary" id="btn-save-group">Create</button>
    </div>
  </div>

  <!-- GROUP DETAIL VIEW -->
  <div class="view hidden" id="group-detail-view">
    <div class="group-detail">
      <div class="group-detail-header">
        <h2 class="form-title" id="group-detail-name">Group</h2>
        <button class="btn-icon btn-share" id="btn-share-invite" title="Share invite link">ğŸ”—</button>
      </div>

      <div class="group-members" id="group-members"></div>

      <div class="group-expenses-header">
        <span class="form-label">Expenses</span>
        <button class="btn-icon btn-add-small" id="btn-add-group-expense">+</button>
      </div>
      <div class="expense-list" id="group-expense-list"></div>
      <div class="empty-state hidden" id="group-expenses-empty">
        <div class="empty-icon">ğŸ’°</div>
        <p>No expenses in this group</p>
        <p class="empty-hint">Tap + to add the first expense</p>
      </div>

      <button class="btn btn-danger hidden" id="btn-delete-group">Delete Group</button>
    </div>
  </div>

  <!-- ADD GROUP EXPENSE VIEW -->
  <div class="view hidden" id="add-group-expense-view">
    <div class="form-view">
      <h2 class="form-title" id="group-expense-form-title">Add Group Expense</h2>

      <div class="form-group">
        <label class="form-label">Amount</label>
        <div class="amount-input-wrap">
          <input type="number" class="form-input" id="input-group-amount"
                 placeholder="0.00" inputmode="decimal" step="0.01" min="0">
          <span class="currency-label" id="group-form-currency">ETB</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Category</label>
        <input type="hidden" id="input-group-category" value="food">
        <div class="category-grid" id="group-category-grid">
          <div class="category-option selected" data-cat="food">
            <span class="cat-icon">ğŸ”</span>
            <span class="cat-name">Food</span>
          </div>
          <div class="category-option" data-cat="transport">
            <span class="cat-icon">ğŸšŒ</span>
            <span class="cat-name">Transport</span>
          </div>
          <div class="category-option" data-cat="bills">
            <span class="cat-icon">ğŸ“„</span>
            <span class="cat-name">Bills</span>
          </div>
          <div class="category-option" data-cat="other">
            <span class="cat-icon">ğŸ“¦</span>
            <span class="cat-name">Other</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Note (optional)</label>
        <input type="text" class="form-input" id="input-group-note"
               placeholder="e.g., Dinner together" maxlength="100">
      </div>

      <button class="btn btn-primary" id="btn-save-group-expense">Save</button>
    </div>
  </div>

  <!-- JOIN GROUP VIEW -->
  <div class="view hidden" id="join-group-view">
    <div class="form-view" style="text-align:center;padding-top:40px">
      <div style="font-size:48px;margin-bottom:16px">ğŸ‘¥</div>
      <h2 class="form-title" id="join-group-title">Join Group</h2>
      <p class="empty-hint" id="join-group-desc" style="margin-bottom:20px">You've been invited to join a group</p>
      <button class="btn btn-primary" id="btn-confirm-join">Join Group</button>
    </div>
  </div>

  <!-- Footer summary -->
  <div class="summary-footer" id="summary-footer">No expenses this month</div>

  <!-- FAB for non-Telegram browsers -->
  <button class="btn btn-primary add-fab" id="add-fab"
          style="position:fixed;bottom:60px;right:16px;width:auto;padding:12px 20px;border-radius:24px;z-index:90;box-shadow:0 2px 12px rgba(0,0,0,0.15)">
    + Add
  </button>

  <script src="storage.js"></script>
  <script src="ui.js"></script>
  <script src="app.js"></script>
</body>
</html>
